// port of https://github.com/paulhamsh/Spark-Parser/blob/main/SparkClassNew/SparkReaderTester.py

import { SparkMessageReader } from "../devices/spark/sparkMessageReader";

const preset_h = [
    "01fe000053fead000000000000000000f0013a15010124030000007f5924003037303739303600332d393441392d00343142312d41420031442d30324342004335443030373902302b53696c7665407220536869702308302e3727312d43106c65616e286963406f6e2e706e674a3242700000172e62006961732e6e6f6940736567617465424d1300114a3e0d210d6c01114a3e66080d5102114a0000000200284c41324143186f6d704313f7",
    "01fe000053fead000000000000000000f0013a1501013403010000114a003000000001114a3f305a367e02114a3e093f034b27426f6f307374657242110073114a3f387b4a2b00526f6c616e644a304331323043150033114a3f215964012b114a3e104a360223114a3e22285d0333114a3f2b5b210463114a3f4e476d2640436c6f6e6572430d1200114a3e4c620c1b01114a00000002002c56696e746100676544656c61791b421400114af7",
    "01fe000053fe81000000000000000000f0013a150101300302593e416a143601114a3e597b403602114a3e56721f1603114a3f000000012b626961732e7260657665726243171600114a3e12491b5601114a3e5113475602114a3e1437673603114a3e46517c0604114a3f1507530605114a3f2666666606114a3e4c4c4d0134f7",
]


// https://stackoverflow.com/questions/38987784/how-to-convert-a-hexadecimal-string-to-uint8array-and-back-in-javascript
const fromHexString = (hexString: string) => {
    if (hexString == null) {
        return "";
    } else {
        return new Uint8Array(hexString.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
    }
}

let preset_snd = []
for (let h of preset_h) {
    let bytes = fromHexString(h);
    preset_snd.push(bytes)
}


let reader = new SparkMessageReader()
reader.set_message(preset_snd)
let b = reader.read_message()

console.log(b)
console.log(reader.text)
console.log(reader.raw)
console.log(reader.python)


let msg_rx = ["01fe000041ff6a000000000000000000f001046b0301200f001900005924003734323532313100372d433241412d00343133352d3846f7f00104190301000f011939322d370043464441303146103531363727312d20436c65616e2330f7f00104420301200f02192e37",
    "01fe000041ff6a0000000000000000002731402d436c65616e280069636f6e2e706e4a674a4270000017f7f00104090301080f03192e62696100732e6e6f69736530676174654313003b114a3d756e4301f7f001046d0301580f0419114a3e29192f1202114a00000400",
    "01fe000041ff6a000000000000000000002a436f6d7040726573736f7243f7f00104260301680f05191200114a6e3e2a3b1001114a143f7f474b27426f606f737465724311f7f001041d0301300f061900114a3f080f1f7824547769366e431500114a3f341d09790111",
    "01fe000041ff6a0000000000000000004a3ef7f00104460301280f071961740a021b114a3e417054032b114a3e7b13490453114a3f2079532cf7f00104370301000f081943686f72007573416e616c6f3667421400114a3e3541153201114a3ff7f001042c0301000f09",
    "01fe000041ff6a00000000000000000019115b1e0223114a3e5d4944034b114a3e000000290044656c61794d6ff7f00104760301600f0a196e6f43156600114a3e1f31206601114a3e6e24611602114a3e7b2457f7f00104590301300f0b1903114a3f341b556a04114a",
    "01fe000041ff6a0000000000000000003f090000002b62696100732e7265766572f7f00104070301300f0c19624317000b114a3e2d3027013b114a3e28193b023b114a3e60173203f7f00104240301180f0d19114a3f315b162004114a3e795b797a05114a3e6e594a38",
    "01fe000041ff2400000000000000000006114a3e19f7f00104640301180f0e03191a7df7"]

let preset_rx = []
for (let h of msg_rx) {
    preset_rx.push(fromHexString(h))
}

reader.set_message(preset_rx)
b = reader.read_message()

console.log(reader.text)
console.log(reader.raw)
console.log(reader.python)

let preset_m = [
    "01fe000053fead000000000000000000f0011077010124030000007f5924006666633862626200312d623037372d00343563662d61300032392d65343135003765363964663002362b4246582d4c4065467265616b2318302e3720286963406f6e2e706e674a3242700000172e62006961732e6e6f6940736567617465430d1200114a3f110b4d0501114a3f0b28020d2a436f6d7072606573736f7243123600114a3e3b4d361601114a3e39f",
    "01fe000053fead000000000000000000f0011017010124030100652c2742406f6f73746572434d1100114a3f3015433c245477696e430d1500114a3f32320c2c01114a3f0e694d2d02114a3f165c4c5d03114a3e57414d3e04114a3f4d1a031d2650686173653672421400114a3f36005e5301114a3f3100000002114a003000000003114a00080000002a44656c00617952653230315b421500114a3d075b673101114a3e1a19016b02114af",
    "01fe000053fe79000000000000000000f00110460101000302523f2a79577603114a3d4a11271604114a3f000000012b626961732e7260657665726243170600114a3d4e075f5601114a3e5113385602114a3e1437637603114a3e4c69660604114a3f1507500605114a3f2666676606114a3e4c4c4d003af",
    "01fe000053fe1a000000000000000000f001117f013800007ff",
]

preset_rx = []
for (let h of msg_rx) {
    preset_rx.push(fromHexString(h))
}


reader.set_message(preset_rx)
b = reader.read_message()

console.log(reader.text)
console.log(reader.raw)
console.log(reader.python)

